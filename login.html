<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login via Telegram</title>
</head>
<body>
    <!-- Кнопка входа через Telegram -->
    <script async src="https://telegram.org/js/telegram-widget.js?22" 
            data-telegram-login="nontube_videobot" 
            data-size="large" 
            data-userpic="false" 
            data-onauth="onTelegramAuth(user)" 
            data-request-access="write"></script>

    <script>
        function onTelegramAuth(user) {
            // Формируем данные пользователя в JSON
            const userData = {
                id: user.id,
                first_name: user.first_name,
                last_name: user.last_name || '',
                username: user.username || '',
                photo_url: user.photo_url || '',
                auth_date: user.auth_date,
                hash: user.hash
            };

            // Перенаправляем на auth.htm с данными в URL
            window.location.href = `auth.htm?user_data=${encodeURIComponent(JSON.stringify(userData))}`;
        }
    </script>

    <!-- Fallback, если кнопка не загрузилась -->
    <div id="telegram-login-fallback" style="display: none; color: red;">
        <p>Ошибка: кнопка Telegram не загрузилась. Проверьте:</p>
        <ul>
            <li>Домен добавлен в @BotFather (/setdomain).</li>
            <li>Бот @nontube_videobot существует.</li>
            <li>Страница открыта по HTTPS (не localhost).</li>
        </ul>
    </div>

    <script>
        // Проверка загрузки кнопки через 3 секунды
        setTimeout(() => {
            if (!document.querySelector('iframe[src*="telegram.org"]')) {
                document.getElementById('telegram-login-fallback').style.display = 'block';
            }
        }, 3000);
    </script>
</body>
</html>    
